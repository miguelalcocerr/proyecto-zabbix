Proyecto zabbix en contenedores usando docker compose:






REPOSITORIO DE ZABBIX
wget https://repo.zabbix.com/zabbix/6.4/ubuntu/pool/main/z/zabbix-release/zabbix-release_6.4-1+ubuntu22.04_all.deb
   64  dpkg -i zabbix-release_6.4-1+ubuntu22.04_all.deb
   65  apt update 
   66  apt install zabbix-agent2 zabbix-agent2-plugin-*
   67  systemctl restart zabbix-agent2
   68  systemctl enable zabbix-agent2
   69  systemctl status  zabbix-agent2

Cambiando el hostname del linux   
hostnamectl  set-hostname ubuntumiguel01
   74  exec hostnamectl 
   75  cat /etc/hosts

########################################################################
Implementando zabbix on-premises:

Estructura completa en sdb






bash# 1. Crear PV y VG
pvcreate /dev/sdb
vgcreate vg_zabbix /dev/sdb

# 2. Crear todos los LVs
lvcreate -L 20G -n lv_mysql vg_zabbix
lvcreate -L 10G -n lv_zabbix_logs vg_zabbix
lvcreate -L 5G  -n lv_zabbix_web vg_zabbix
lvcreate -L 1G  -n lv_zabbix_etc vg_zabbix

# 3. Formatear
mkfs.xfs /dev/vg_zabbix/lv_mysql
mkfs.xfs /dev/vg_zabbix/lv_zabbix_logs
mkfs.xfs /dev/vg_zabbix/lv_zabbix_web
mkfs.xfs /dev/vg_zabbix/lv_zabbix_etc

# 4. Crear directorios
mkdir -p /var/lib/mysql
mkdir -p /var/log/zabbix
mkdir -p /usr/share/zabbix
mkdir -p /etc/zabbix

# 5. Agregar a fstab
cat >> /etc/fstab << 'EOF'
/dev/vg_zabbix/lv_mysql        /var/lib/mysql      xfs  defaults  0 0
/dev/vg_zabbix/lv_zabbix_logs  /var/log/zabbix     xfs  defaults  0 0
/dev/vg_zabbix/lv_zabbix_web   /usr/share/zabbix   xfs  defaults  0 0
/dev/vg_zabbix/lv_zabbix_etc   /etc/zabbix         xfs  defaults  0 0
EOF

# 6. Montar todo
mount -a

# 7. Verificar
df -h | grep zabbix
lsblk /dev/sdb


# Instalar herramientas b치sicas
dnf install -y epel-release vim wget curl net-tools bind-utils telnet

# Instalar y habilitar Chrony (NTP)
dnf install -y chrony
systemctl enable chronyd --now
chronyc tracking

# Configurar hostname
hostnamectl set-hostname zabbix.dominio.pe
echo "$(hostname -I | awk '{print $1}') zabbix.dominio.pe zabbix" >> /etc/hosts


PASO 3: Instalar MySQL 8.0
bash# Instalar repositorio MySQL
dnf install -y https://dev.mysql.com/get/mysql80-community-release-el9-4.noarch.rpm

# Instalar MySQL Server
dnf install -y mysql-community-server

# Iniciar y habilitar
systemctl enable mysqld --now

# Obtener password temporal
grep 'temporary password' /var/log/mysqld.log

# Ejecutar secure installation (cambiar password root)
mysql_secure_installation
PASO 4: Crear Base de Datos Zabbix
bash# Conectar a MySQL
mysql -u root -p

# Ejecutar estos comandos SQL:
CREATE DATABASE zabbix CHARACTER SET utf8mb4 COLLATE utf8mb4_bin;
CREATE USER 'zabbix'@'localhost' IDENTIFIED BY 'TU_PASSWORD_SEGURO';
GRANT ALL PRIVILEGES ON zabbix.* TO 'zabbix'@'localhost';
SET GLOBAL log_bin_trust_function_creators = 1;
FLUSH PRIVILEGES;
EXIT;
PASO 5: Instalar Zabbix 7.0 LTS (Oficial)
bash# a. Instalar repositorio Zabbix
rpm -Uvh https://repo.zabbix.com/zabbix/7.0/rocky/9/x86_64/zabbix-release-latest-7.0.el9.noarch.rpm
dnf clean all


# Excluir paquetes Zabbix de EPEL
dnf config-manager --setopt=epel.excludepkgs=zabbix* --save

# Limpiar cache
dnf clean all

# Reinstalar
dnf install -y zabbix-server-mysql zabbix-web-mysql zabbix-nginx-conf zabbix-sql-scripts zabbix-selinux-policy zabbix-agent2



# b. Instalar paquetes Zabbix
dnf install -y zabbix-server-mysql zabbix-web-mysql zabbix-nginx-conf zabbix-sql-scripts zabbix-selinux-policy zabbix-agent2

# c. Importar esquema (2-5 min)
zcat /usr/share/zabbix-sql-scripts/mysql/server.sql.gz | mysql --default-character-set=utf8mb4 -uzabbix -p zabbix

# d. Desactivar log_bin_trust_function_creators
mysql -u root -p -e "SET GLOBAL log_bin_trust_function_creators = 0;"



PASO 6: Configurar Zabbix Server

# Configurar zabbix_server.conf
sed -i 's/^# DBHost=localhost/DBHost=localhost/' /etc/zabbix/zabbix_server.conf
sed -i 's/^# DBPassword=/DBPassword=PASSWORD/' /etc/zabbix/zabbix_server.conf

# Verificar configuraci칩n
grep -E "^DB" /etc/zabbix/zabbix_server.conf




PASO 7: Configurar NGINX
bash# Configurar listen port y server_name
sed -i 's/#        listen          8080;/        listen 8080;/' /etc/nginx/conf.d/zabbix.conf
sed -i 's/#        server_name     example.com;/        server_name zabbix.marriott.local;/' /etc/nginx/conf.d/zabbix.conf

# Verificar
grep -E "listen|server_name" /etc/nginx/conf.d/zabbix.conf | head -4


PASO 8: Configurar PHP Timezone
bash# Configurar timezone Lima
sed -i 's/^; php_value\[date.timezone\].*/php_value[date.timezone] = America\/Lima/' /etc/php-fpm.d/zabbix.conf

# Verificar
grep "date.timezone" /etc/php-fpm.d/zabbix.conf


PASO 9: Iniciar Servicios
bashsystemctl restart zabbix-server zabbix-agent2 nginx php-fpm
systemctl enable zabbix-server zabbix-agent2 nginx php-fpm
systemctl status zabbix-server nginx --no-pager



## PASO 10: Acceder al Frontend
```
URL: http://<IP_SERVIDOR>:8080
Usuario: Admin
Password: zabbix


#########################################################################
Implementando Grafana On-Premises

# Actualizar sistema
dnf update -y

# Instalar herramientas b치sicas
dnf install -y vim wget curl net-tools

# Importar GPG key
wget -q -O gpg.key https://rpm.grafana.com/gpg.key
rpm --import gpg.key

# Crear archivo de repositorio
cat > /etc/yum.repos.d/grafana.repo << 'EOF'
[grafana]
name=grafana
baseurl=https://rpm.grafana.com
repo_gpgcheck=1
enabled=1
gpgcheck=1
gpgkey=https://rpm.grafana.com/gpg.key
sslverify=1
sslcacert=/etc/pki/tls/certs/ca-bundle.crt
EOF

# Verificar repositorio
dnf repolist | grep grafana


# Instalar Grafana Open Source
dnf install grafana -y

# Verificar versi칩n instalada
grafana-server -v

# Recargar systemd
systemctl daemon-reload

# Habilitar e iniciar Grafana
systemctl enable grafana-server --now

# Verificar estado
systemctl status grafana-server --no-pager

# Verificar puerto 3000
ss -tlnp | grep 3000



ASE 5: Instalar Plugin Zabbix
bash# Instalar plugin oficial Zabbix
grafana-cli plugins install alexanderzobnin-zabbix-app

# Reiniciar Grafana para cargar el plugin
systemctl restart grafana-server

# Verificar estado
systemctl status grafana-server --no-pager



